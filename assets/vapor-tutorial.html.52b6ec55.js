import{r as t,o as e,c as o,a as n,e as a,F as c,d as l,b as p}from"./app.01142347.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const i={},r=l(`<p align="right">2021-7-23</p><p>\u5185\u5BB9\u7B80\u4ECB\uFF1A</p><ol><li>\u5B89\u88C5 vapor</li><li>\u65B0\u5EFA vapor \u5DE5\u7A0B</li><li>\u521B\u5EFA\u6570\u636E\u5E93\u8868\uFF08SQLite \u6570\u636E\u5E93\uFF09</li><li>\u7F16\u5199 CURD \u63A5\u53E3</li><li>\u8FDB\u884C\u63A5\u53E3\u6D4B\u8BD5</li></ol><h4 id="\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883" aria-hidden="true">#</a> \u73AF\u5883</h4><p>Xcode 12.2</p><p>Swift 5.3.1</p><h4 id="\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>brew <span class="token function">install</span> vapor
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4E0B\u8F7D\u5B8C\u6210\u4E4B\u540E\u901A\u8FC7 <code>vapor --help</code> \u67E5\u770B\u4F7F\u7528\u4FE1\u606F</p><h4 id="\u65B0\u5EFA\u5DE5\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u65B0\u5EFA\u5DE5\u7A0B" aria-hidden="true">#</a> \u65B0\u5EFA\u5DE5\u7A0B</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>vapor new <span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u65B0\u5EFA\u4E00\u4E2A ToDoList \u5DE5\u7A0B (\u4F7F\u7528 <code>fluent</code> \u5E76\u9009\u62E9 <code>SQLite</code> \u5B58\u50A8\u6570\u636E, \u4E0D\u4F7F\u7528 <code>leaf</code> )\uFF0C\u547D\u4EE4\u884C\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ vapor new ToDoList    
Cloning template<span class="token punctuation">..</span>.
name: ToDoList
Would you like to use Fluent? <span class="token punctuation">(</span>--fluent/--no-fluent<span class="token punctuation">)</span>
y/n<span class="token operator">&gt;</span> y
fluent: Yes
db: SQLite
Would you like to use Leaf? <span class="token punctuation">(</span>--leaf/--no-leaf<span class="token punctuation">)</span>
y/n<span class="token operator">&gt;</span> n
leaf: No
Generating project files
+ Package.swift
+ main.swift
+ configure.swift
+ routes.swift
+ Todo.swift
+ CreateTodo.swift
+ .gitkeep
+ TodoController.swift
+ AppTests.swift
+ Dockerfile
+ docker-compose.yml
+ .gitignore
+ .dockerignore
Creating <span class="token function">git</span> repository
Adding first commit
                                                                                   
                                                                  **               
                                                                **~~**             
                                                              **~~~~~~**           
                                                            **~~~~~~~~~~**         
                                                          **~~~~~~~~~~~~~~**       
                                                        **~~~~~~~~~~~~~~~~~~**     
                                                      **~~~~~~~~~~~~~~~~~~~~~~**   
                                                     **~~~~~~~~~~~~~~~~~~~~~~~~**  
                                                    **~~~~~~~~~~~~~~~~~~~~~~~~~~** 
                                                   **~~~~~~~~~~~~~~~~~~~~~~~~~~~~**
                                                   **~~~~~~~~~~~~~~~~~~~~~~~~~~~~**
                                                   **~~~~~~~~~~~~~~~~~~~~~++++~~~**
                                                    **~~~~~~~~~~~~~~~~~~~++++~~~** 
                                                     ***~~~~~~~~~~~~~~~++++~~~***  
                                                       ****~~~~~~~~~~++++~~****    
                                                          *****~~~~~~~~~*****      
                                                             *************         
                                                                                   
                                                    _       __    ___   ___   ___  
                                                   <span class="token punctuation">\\</span> <span class="token punctuation">\\</span>  /  / /<span class="token punctuation">\\</span>  <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span> / / <span class="token punctuation">\\</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span> 
                                                    <span class="token punctuation">\\</span>_<span class="token punctuation">\\</span>/  /_/--<span class="token punctuation">\\</span> <span class="token operator">|</span>_<span class="token operator">|</span>   <span class="token punctuation">\\</span>_<span class="token punctuation">\\</span>_/ <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token punctuation">\\</span> 
                                                      a web framework <span class="token keyword">for</span> Swift    
                                                                                   
                                                  Project ToDoList has been created<span class="token operator">!</span>
                                                                   
                                           Use <span class="token builtin class-name">cd</span> <span class="token string">&#39;ToDoList&#39;</span> to enter the project directory
                                             Use vapor xcode to <span class="token function">open</span> the project <span class="token keyword">in</span> Xcode
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h5 id="\u6253\u5F00\u5DE5\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u6253\u5F00\u5DE5\u7A0B" aria-hidden="true">#</a> \u6253\u5F00\u5DE5\u7A0B</h5><ol><li>\u8FDB\u5165\u5230\u9879\u76EE\u76EE\u5F55</li><li>\u7EC8\u7AEF\u8FD0\u884C <code>vapor xcode</code> \u547D\u4EE4\u6253\u5F00\u5DE5\u7A0B\uFF1B</li><li>\u53CC\u51FB Package.swift \u6587\u4EF6\u6253\u5F00\u5DE5\u7A0B</li></ol><h5 id="\u9879\u76EE\u76EE\u5F55\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a> \u9879\u76EE\u76EE\u5F55\u7ED3\u6784</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
\u251C\u2500\u2500 Dockerfile
\u251C\u2500\u2500 Package.swift
\u251C\u2500\u2500 Sources
\u2502   \u251C\u2500\u2500 App
\u2502   \u2502   \u251C\u2500\u2500 Controllers
\u2502   \u2502   \u2502   \u2514\u2500\u2500 TodoController.swift
\u2502   \u2502   \u251C\u2500\u2500 Migrations
\u2502   \u2502   \u2502   \u2514\u2500\u2500 CreateTodo.swift
\u2502   \u2502   \u251C\u2500\u2500 Models
\u2502   \u2502   \u2502   \u2514\u2500\u2500 Todo.swift
\u2502   \u2502   \u251C\u2500\u2500 configure.swift
\u2502   \u2502   \u2514\u2500\u2500 routes.swift
\u2502   \u2514\u2500\u2500 Run
\u2502       \u2514\u2500\u2500 main.swift
\u251C\u2500\u2500 Tests
\u2502   \u2514\u2500\u2500 AppTests
\u2502       \u2514\u2500\u2500 AppTests.swift
\u2514\u2500\u2500 docker-compose.yml
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u6253\u5F00 vapor \u81EA\u52A8\u521B\u5EFA\u7684\u6A21\u7248\u5DE5\u7A0B\uFF0CXcode\u5F00\u59CB\u81EA\u52A8\u4E0B\u8F7D\u6240\u9700\u8981\u7684\u6A21\u5757\uFF0C\u7B49\u5F85\u4E0B\u8F7D\u5B8C\u6BD5\u3002</p><h5 id="\u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55" aria-hidden="true">#</a> \u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55</h5><p>Xcode \u9ED8\u8BA4\u4F1A\u5728 <code>DervedData</code> \u76EE\u5F55\u4E0B\u8FD0\u884C\u3002 \u672A\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7684\u5DE5\u4F5C\u76EE\u5F55\uFF0C vapor \u4F1A\u63D0\u793A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span> WARNING <span class="token punctuation">]</span> No custom working directory <span class="token builtin class-name">set</span> <span class="token keyword">for</span> this scheme, using /path/to/DerivedData/project-abcdef/Build/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u9996\u5148\u627E\u5230 Scheme \u9009\u62E9\u5668\uFF0C\u70B9\u51FB<code>Edit Scheme</code> \uFF0C\u5728\u5BF9\u8BDD\u6846\u4E2D\u9009\u4E2D <code>Run</code> \uFF0C\u9009\u4E2D <code>Options</code> \uFF0C\u52FE\u9009 <code>Use custom working directory:</code> \u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55\u3002</p><h5 id="\u521B\u5EFA\u8868" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u8868" aria-hidden="true">#</a> \u521B\u5EFA\u8868</h5><h6 id="\u7F16\u5199\u8868\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199\u8868\u7ED3\u6784" aria-hidden="true">#</a> \u7F16\u5199\u8868\u7ED3\u6784</h6><ol><li>\u5728 <code>Models</code> \u6587\u4EF6\u5939\u4E0B\u627E\u5230 <code>Todo.swift</code> \u6587\u4EF6\uFF0C \u9ED8\u8BA4\u6709 \u4E00\u4E2A <code>id</code> \u548C <code>title</code> \u5B57\u6BB5\uFF0C\u65B0\u6DFB\u52A0 <code>completed</code> \u548C <code>order</code> \u5B57\u6BB5</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Fluent</span>
<span class="token keyword">import</span> <span class="token class-name">Vapor</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Todo</span><span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">,</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span>
  	<span class="token comment">// \u6570\u636E\u5E93\u4E2D\u8868\u7684\u540D\u79F0</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> schema <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span>
    
    <span class="token attribute atrule">@ID</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token constant">UUID</span><span class="token operator">?</span>

    <span class="token attribute atrule">@Field</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;title&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
    
    <span class="token attribute atrule">@Field</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;completed&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> completed<span class="token punctuation">:</span> <span class="token class-name">Bool</span>
    
    <span class="token attribute atrule">@Field</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;order&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> order<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token constant">UUID</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> completed<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> order<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
        <span class="token keyword">self</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title
        <span class="token keyword">self</span><span class="token punctuation">.</span>completed <span class="token operator">=</span> completed
        <span class="token keyword">self</span><span class="token punctuation">.</span>order <span class="token operator">=</span> order
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="2"><li>\u5728 <code>Migrations</code> \u6587\u4EF6\u5939\u4E0B\u627E\u5230 <code>CreateTodo.swift</code> \u6587\u4EF6\uFF0C\u4E3A\u65B0\u52A0\u7684\u5B57\u6BB5\u8BBE\u7F6E\u5728\u6570\u636E\u5E93\u8868\u4E2D\u7684\u7C7B\u578B\u3001\u9ED8\u8BA4\u503C\u3001\u662F\u5426\u5FC5\u987B\u7B49\u4FE1\u606F\u3002</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Fluent</span>

<span class="token keyword">struct</span> <span class="token class-name">CreateTodo</span><span class="token punctuation">:</span> <span class="token class-name">Migration</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">prepare</span><span class="token punctuation">(</span>on database<span class="token punctuation">:</span> <span class="token class-name">Database</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token class-name">Void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> database<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// \u6570\u636E\u5E93\u4E2D\u8868\u7684\u540D\u79F0</span>
            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// id \u5B57\u6BB5</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title&quot;</span></span><span class="token punctuation">,</span> <span class="token punctuation">.</span>string<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token keyword">required</span><span class="token punctuation">)</span> <span class="token comment">// title \u5B57\u6BB5</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;completed&quot;</span></span><span class="token punctuation">,</span> <span class="token punctuation">.</span>bool<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token keyword">required</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;DEFAULT false&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// completed \u5B57\u6BB5</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;order&quot;</span></span><span class="token punctuation">,</span> <span class="token punctuation">.</span>int<span class="token punctuation">)</span> <span class="token comment">// order \u5B57\u6BB5</span>
            <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u8868</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">revert</span><span class="token punctuation">(</span>on database<span class="token punctuation">:</span> <span class="token class-name">Database</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token class-name">Void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> database<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h6 id="\u751F\u6210\u8868\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u751F\u6210\u8868\u6587\u4EF6" aria-hidden="true">#</a> \u751F\u6210\u8868\u6587\u4EF6</h6><p>\u65B9\u5F0F\u4E00\uFF1A</p><p>\u5728\u547D\u4EE4\u884C\u4E2D\u6267\u884C\uFF1A <code>vapor run migrate</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ vapor run migrate
<span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> Linking Run
Migrate Command: Prepare
The following migration<span class="token punctuation">(</span>s<span class="token punctuation">)</span> will be prepared:
+ App.CreateTodo on default
Would you like to continue?
y/n<span class="token operator">&gt;</span> y
Migration successful
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u65B9\u5F0F\u4E8C\uFF1A</p><p>\u5728 <code>configure.swift</code> \u6587\u4EF6\u4E2D\u7684 <code>app.migrations.add(CreateTodo())</code> \u4E0B\u9762\u6DFB\u52A0 <code>try app.autoMigrate().wait()</code></p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Fluent</span>
<span class="token keyword">import</span> <span class="token class-name">FluentSQLiteDriver</span>
<span class="token keyword">import</span> <span class="token class-name">Vapor</span>

<span class="token comment">// configures your application</span>
<span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">configure</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> app<span class="token punctuation">:</span> <span class="token class-name">Application</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token comment">// uncomment to serve files from /Public folder</span>
    <span class="token comment">// app.middleware.use(FileMiddleware(publicDirectory: app.directory.publicDirectory))</span>

    app<span class="token punctuation">.</span>databases<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">sqlite</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;db.sqlite&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>sqlite<span class="token punctuation">)</span>

    app<span class="token punctuation">.</span>migrations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CreateTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  	<span class="token keyword">try</span> app<span class="token punctuation">.</span><span class="token function">autoMigrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
  	<span class="token comment">// register routes</span>
    <span class="token keyword">try</span> <span class="token function">routes</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u6267\u884C\u5B8C\u6210\u4E4B\u540E\uFF0C\u4F1A\u5728\u9879\u76EE\u76EE\u5F55\u4E0B\u521B\u5EFA <code>db.sqlite</code> \u6587\u4EF6\uFF0C\u540C\u65F6\u751F\u6210 <code>todos</code> \u8868\u3002 <code>todos</code> \u8868\u7684\u5EFA\u8868\u8BED\u53E5\u5982\u4E0B\uFF1A</p><div class="language-sqlite ext-sqlite line-numbers-mode"><pre class="language-sqlite"><code>CREATE TABLE &quot;todos&quot;(
&quot;id&quot; UUID PRIMARY KEY, 
&quot;title&quot; TEXT NOT NULL, 
&quot;completed&quot; INTEGER NOT NULL DEFAULT false, 
&quot;order&quot; INTEGER)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="\u7F16\u5199api" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199api" aria-hidden="true">#</a> \u7F16\u5199API</h5><p>\u5728 Models \u6587\u4EF6\u5939\u4E0B\u521B\u5EFA <code>TodoAPIModel.swift</code> \u6587\u4EF6, \u7528\u6765\u4EE3\u8868\u6570\u636E\u5E93\u4E2D\u8FD4\u56DE\u7684 <code>Todo</code> \u5BF9\u8C61</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Vapor</span>

<span class="token keyword">struct</span> <span class="token class-name">TodoAPIModel</span><span class="token punctuation">:</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">.</span><span class="token class-name">IDValue</span>
    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> completed<span class="token punctuation">:</span> <span class="token class-name">Bool</span>
    <span class="token keyword">let</span> order<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span>
    <span class="token keyword">let</span> url<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">TodoAPIModel</span> <span class="token punctuation">{</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> todo<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">try</span> todo<span class="token punctuation">.</span><span class="token function">requireID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>title <span class="token operator">=</span> todo<span class="token punctuation">.</span>title
        <span class="token keyword">self</span><span class="token punctuation">.</span>completed <span class="token operator">=</span> todo<span class="token punctuation">.</span>completed
        <span class="token keyword">self</span><span class="token punctuation">.</span>order <span class="token operator">=</span> todo<span class="token punctuation">.</span>order
        <span class="token keyword">self</span><span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;http://127.0.0.1:8080/todos/</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation"><span class="token keyword">self</span><span class="token punctuation">.</span>id</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u5F00\u59CB\u7F16\u5199 \u589E\u3001\u5220\u3001\u6539\u3001\u67E5 \u7684API\u63A5\u53E3</p><h5 id="create" tabindex="-1"><a class="header-anchor" href="#create" aria-hidden="true">#</a> Create</h5><ol><li>\u521B\u5EFA\u6A21\u578B\uFF08title \u4E3A\u5FC5\u4F20\u53C2\u6570\uFF0C order \u4E3A\u53EF\u9009\uFF09\uFF0C\u540C\u65F6\u9700\u8981\u6821\u9A8C\u4F20\u9012\u8FC7\u6765\u7684\u53C2\u6570\uFF0C\u662F\u5426\u7B26\u5408\u89C4\u8303</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">CreateRequestBody</span><span class="token punctuation">:</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> order<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span>

    <span class="token keyword">func</span> <span class="token function-definition function">makeTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> order<span class="token punctuation">:</span> order<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">CreateRequestBody</span><span class="token punctuation">:</span> <span class="token class-name">Validatable</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">validations</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> validations<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Validations</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	<span class="token comment">// title \u4E0D\u4E3A\u7A7A\uFF0C\u4E14\u5927\u4E8E1\u4E2A\u5B57\u7B26</span>
        validations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title&quot;</span></span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token keyword">is</span><span class="token punctuation">:</span> <span class="token operator">!</span><span class="token punctuation">.</span>empty <span class="token operator">&amp;&amp;</span> <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token comment">// order \u9700\u8981\u5927\u4E8E0</span>
        validations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;order&quot;</span></span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token keyword">is</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">required</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>\u5728 <code>TodoController.swift</code> \u6587\u4EF6\u5185\u7F16\u5199API</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span>routes<span class="token punctuation">:</span> <span class="token class-name">RoutesBuilder</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> todos <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">grouped</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> create<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function-definition function">create</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token class-name">TodoAPIModel</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">// \u6821\u9A8C\u4F20\u9012\u53C2\u6570</span>
    <span class="token keyword">try</span> <span class="token class-name">CreateRequestBody</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> req<span class="token punctuation">)</span>
  	
  	<span class="token comment">// \u53C2\u6570\u8F6C\u4E3A CreateRequestBody \u6A21\u578B</span>
    <span class="token keyword">let</span> requestBody <span class="token operator">=</span> <span class="token keyword">try</span> req<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CreateRequestBody</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
  	
  	<span class="token comment">// \u6784\u5EFA Todo \u6A21\u578B</span>
    <span class="token keyword">let</span> todo <span class="token operator">=</span> requestBody<span class="token punctuation">.</span><span class="token function">makeTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
  	<span class="token keyword">return</span> todo<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span> <span class="token comment">// \u5B58\u5165\u6570\u636E\u5E93</span>
        <span class="token punctuation">.</span>flatMapThrowing <span class="token punctuation">{</span> <span class="token keyword">try</span> <span class="token class-name">TodoAPIModel</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// \u8FD4\u56DE TodoAPIModel \u6A21\u578B</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="3"><li>\u6D4B\u8BD5</li></ol><p>\u901A\u8FC7 curl \u6D4B\u8BD5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -H <span class="token string">&quot;Content-Type: application/json&quot;</span> -d <span class="token string">&#39;{&quot;title&quot;: &quot;learn vapor&quot;, &quot;order&quot;: 3}&#39;</span> -X POST <span class="token string">&quot;http://127.0.0.1:8080/todos&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u901A\u8FC7\u6D4B\u8BD5\u4EE3\u7801\uFF1A</p><p>\u5728 <code>AppTest.swift</code> \u6587\u4EF6\u5185\u6DFB\u52A0\u6D4B\u8BD5\u4EE3\u7801</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">testCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">.</span>testing<span class="token punctuation">)</span>
    <span class="token keyword">defer</span> <span class="token punctuation">{</span> app<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token function">configure</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

    <span class="token keyword">let</span> todoModel <span class="token operator">=</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;learn vapor&quot;</span></span><span class="token punctuation">,</span> order<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> app<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">,</span> beforeRequest<span class="token punctuation">:</span> <span class="token punctuation">{</span> req <span class="token keyword">in</span>
        <span class="token keyword">try</span> req<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>todoModel<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> afterResponse<span class="token punctuation">:</span> <span class="token punctuation">{</span> res <span class="token keyword">in</span>
        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token punctuation">.</span>ok<span class="token punctuation">)</span>
        <span class="token keyword">let</span> model <span class="token operator">=</span> <span class="token keyword">try</span> res<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">TodoAPIModel</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\n</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">model</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">\\n&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> Update</h5><ol><li>\u521B\u5EFA\u6A21\u578B</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">UpdateRequestBody</span><span class="token punctuation">:</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    <span class="token keyword">let</span> completed<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token operator">?</span>
    <span class="token keyword">let</span> order<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>\u5728 <code>TodoController.swift</code> \u6587\u4EF6\u5185\u7F16\u5199API</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span>routes<span class="token punctuation">:</span> <span class="token class-name">RoutesBuilder</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
  	<span class="token comment">// \u8BF7\u6C42\u8FDB\u884C\u5206\u7EC4  </span>
  	<span class="token keyword">let</span> todos <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">grouped</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> create<span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;:todoID&quot;</span></span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> update<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token class-name">TodoAPIModel</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u67E5\u627E url \u5185\u5236\u5B9A todo</span>
  	<span class="token keyword">guard</span> <span class="token keyword">let</span> todoIDString <span class="token operator">=</span> req<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todoID&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">let</span> todoID <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span>todoIDString<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badRequest<span class="token punctuation">,</span> reason<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Invalid parameter \`todoID\`&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
		
  	<span class="token comment">// \u8BF7\u6C42\u53C2\u6570\u8F6C\u6A21\u578B</span>
    <span class="token keyword">let</span> requestBody <span class="token operator">=</span> <span class="token keyword">try</span> req<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">UpdateRequestBody</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token class-name">Todo</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>todoID<span class="token punctuation">,</span> on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span> <span class="token comment">// \u6839\u636Eid\u5728\u6570\u636E\u5E93\u4E2D\u67E5\u627E\u6570\u636E</span>
        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span>or<span class="token punctuation">:</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>notFound<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// \u672A\u627E\u5230\uFF0C\u76F4\u63A5\u8FD4\u56DE</span>
        <span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span> todo <span class="token keyword">in</span>  <span class="token comment">// todo \u4EE3\u8868\u5DF2\u7ECF\u67E5\u627E\u5230\u7684\u5BF9\u8C61</span>
            <span class="token comment">// \u66F4\u65B0\u5DF2\u7ECF\u67E5\u627E\u5230\u7684 todo \u5BF9\u8C61\u7684\u6570\u636E</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> title <span class="token operator">=</span> requestBody<span class="token punctuation">.</span>title <span class="token punctuation">{</span>
                todo<span class="token punctuation">.</span>title <span class="token operator">=</span> title
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> completed <span class="token operator">=</span> requestBody<span class="token punctuation">.</span>completed <span class="token punctuation">{</span>
                todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> completed
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> order <span class="token operator">=</span> requestBody<span class="token punctuation">.</span>order <span class="token punctuation">{</span>
                todo<span class="token punctuation">.</span>order <span class="token operator">=</span> order
            <span class="token punctuation">}</span>
            <span class="token comment">// \u5B58\u5165\u6570\u636E\u5E93</span>
            <span class="token keyword">return</span> todo<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> todo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span>flatMapThrowing <span class="token punctuation">{</span> <span class="token keyword">try</span> <span class="token class-name">TodoAPIModel</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// \u628A\u5DF2\u7ECF\u4FEE\u6539\u597D\u7684 todo \u5BF9\u8C61\uFF0C\u8F6C\u6210 TodoAPIModel \u6A21\u578B</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol start="3"><li>\u6D4B\u8BD5</li></ol><p>\u901A\u8FC7 curl \u6D4B\u8BD5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">&quot;http://127.0.0.1:8080/todos/056A865C-293D-455A-BCAB-5E8B375F9952&quot;</span>
<span class="token function">curl</span> -H <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\\</span>
	-d <span class="token string">&#39;{&quot;title&quot;: &quot;learn vapor this year&quot;, &quot;completed&quot;: true, &quot;order&quot;: 0}&#39;</span><span class="token punctuation">\\</span>
	-X PATCH <span class="token string">&quot;<span class="token variable">\${url}</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u901A\u8FC7\u6D4B\u8BD5\u4EE3\u7801\uFF1A</p><p>\u5728 <code>AppTest.swift</code> \u6587\u4EF6\u5185\u6DFB\u52A0\u6D4B\u8BD5\u4EE3\u7801</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">testCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">.</span>testing<span class="token punctuation">)</span>
    <span class="token keyword">defer</span> <span class="token punctuation">{</span> app<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token function">configure</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

    <span class="token keyword">let</span> todoID <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;056A865C-293D-455A-BCAB-5E8B375F9952&quot;</span></span>
    <span class="token keyword">let</span> todoModel <span class="token operator">=</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;learn vapor this year&quot;</span></span><span class="token punctuation">,</span> completed<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> order<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span> app<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token constant">PATCH</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;todos/</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">todoID</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> beforeRequest<span class="token punctuation">:</span> <span class="token punctuation">{</span> req <span class="token keyword">in</span>
        <span class="token keyword">try</span> req<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>todoModel<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> afterResponse<span class="token punctuation">:</span> <span class="token punctuation">{</span> res <span class="token keyword">in</span>
        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token punctuation">.</span>ok<span class="token punctuation">)</span>
        <span class="token keyword">let</span> model <span class="token operator">=</span> <span class="token keyword">try</span> res<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">TodoAPIModel</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="get" tabindex="-1"><a class="header-anchor" href="#get" aria-hidden="true">#</a> Get</h5><p>\u83B7\u53D6\u6240\u6709\u7684 todo \u5217\u8868</p><ol><li>\u5728 <code>TodoController.swift</code> \u6587\u4EF6\u5185\u7F16\u5199API</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span>routes<span class="token punctuation">:</span> <span class="token class-name">RoutesBuilder</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
  	<span class="token comment">// \u8BF7\u6C42\u8FDB\u884C\u5206\u7EC4  </span>
  	<span class="token keyword">let</span> todos <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">grouped</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> create<span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;:todoID&quot;</span></span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> update<span class="token punctuation">)</span>
  	
  	todos<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> index<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">TodoAPIModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Todo</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u67E5\u627E\u6240\u6709\u6570\u636E</span>
        <span class="token punctuation">.</span>flatMapThrowing <span class="token punctuation">{</span> todos <span class="token keyword">in</span>
            <span class="token comment">// convert \`todos\` to \`[TodoAPIModel]</span>
            <span class="token keyword">try</span> todos<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">try</span> <span class="token class-name">TodoAPIModel</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>\u6D4B\u8BD5</li></ol><p>\u901A\u8FC7 curl \u6D4B\u8BD5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">&quot;http://127.0.0.1:8080/todos/&quot;</span>
<span class="token function">curl</span> <span class="token string">&quot;<span class="token variable">\${url}</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u901A\u8FC7\u6D4B\u8BD5\u4EE3\u7801\uFF1A</p><p>\u5728 <code>AppTest.swift</code> \u6587\u4EF6\u5185\u6DFB\u52A0\u6D4B\u8BD5\u4EE3\u7801</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">convertStringToArray</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> jsonArray <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONSerialization</span><span class="token punctuation">.</span><span class="token function">jsonObject</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> data<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">.</span>allowFragments<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> jsonArray
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">testGetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">.</span>testing<span class="token punctuation">)</span>
    <span class="token keyword">defer</span> <span class="token punctuation">{</span> app<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token function">configure</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

    <span class="token keyword">try</span> app<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">,</span> afterResponse<span class="token punctuation">:</span> <span class="token punctuation">{</span> res <span class="token keyword">in</span>
        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token punctuation">.</span>ok<span class="token punctuation">)</span>

        <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token function">convertStringToArray</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">.</span>string<span class="token punctuation">)</span>
        <span class="token keyword">for</span> element <span class="token keyword">in</span> array <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\n</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">element</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;\\nend\\n&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h5 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> Delete</h5><p>\u6839\u636E id \u5220\u9664\u67D0\u4E00\u4E2Atodo\u5217\u8868</p><ol><li>\u5728 <code>TodoController.swift</code> \u6587\u4EF6\u5185\u7F16\u5199API</li></ol><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span>routes<span class="token punctuation">:</span> <span class="token class-name">RoutesBuilder</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
  	<span class="token comment">// \u8BF7\u6C42\u8FDB\u884C\u5206\u7EC4  </span>
  	<span class="token keyword">let</span> todos <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">grouped</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todos&quot;</span></span><span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> create<span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;:todoID&quot;</span></span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> update<span class="token punctuation">)</span>
  	todos<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> index<span class="token punctuation">)</span>
  	
  	todos<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;:todoID&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> todo <span class="token keyword">in</span>
        todo<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>use<span class="token punctuation">:</span> delete<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">EventLoopFuture</span><span class="token operator">&lt;</span><span class="token class-name">HTTPStatus</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Todo</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;todoID&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span> <span class="token comment">// \u6570\u636E\u5E93\u6839\u636E todoID \u67E5\u627E</span>
        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span>or<span class="token punctuation">:</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>notFound<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// \u672A\u627E\u5230\uFF1A\u76F4\u63A5\u8FD4\u56DE</span>
        <span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> req<span class="token punctuation">.</span>db<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// \u627E\u5230\uFF1A \u4ECE\u6570\u636E\u5E93\u5220\u9664</span>
        <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">.</span>ok<span class="token punctuation">)</span>  <span class="token comment">// \u8FD4\u56DE\u6210\u529F\u7684\u72B6\u6001\u7801</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="2"><li>\u6D4B\u8BD5</li></ol><p>\u901A\u8FC7 curl \u6D4B\u8BD5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">&quot;http://127.0.0.1:8080/todos/056A865C-293D-455A-BCAB-5E8B375F9952&quot;</span>
<span class="token function">curl</span> -X DELETE <span class="token string">&quot;<span class="token variable">\${url}</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u901A\u8FC7\u6D4B\u8BD5\u4EE3\u7801\uFF1A</p><p>\u5728 <code>AppTest.swift</code> \u6587\u4EF6\u5185\u6DFB\u52A0\u6D4B\u8BD5\u4EE3\u7801</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">.</span>testing<span class="token punctuation">)</span>
    <span class="token keyword">defer</span> <span class="token punctuation">{</span> app<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token function">configure</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

    <span class="token keyword">let</span> todoID <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;056A865C-293D-455A-BCAB-5E8B375F9952&quot;</span></span>
    <span class="token keyword">try</span> app<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;todos/</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">todoID</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> afterResponse<span class="token punctuation">:</span> <span class="token punctuation">{</span> res <span class="token keyword">in</span>
        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token punctuation">.</span>ok<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="\u67E5\u770B\u6240\u6709\u7684api\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u6240\u6709\u7684api\u63A5\u53E3" aria-hidden="true">#</a> \u67E5\u770B\u6240\u6709\u7684API\u63A5\u53E3</h5><ol><li>\u5728 <code>Scheme</code> \u9009\u9879\u4E2D\uFF0C\u70B9\u51FB <code>Edit Scheme</code>\uFF0C \u9009\u4E2D <code>Run</code> -&gt; <code>Arguments</code> \uFF0C\u5728 <code>Arguments Passed On Launch</code> \u4E2D\u6DFB\u52A0 <code>routes</code> \u5B57\u6BB5\uFF0C\u8FD0\u884C\u7A0B\u5E8F\uFF0C\u5728\u63A7\u5236\u53F0\u4F1A\u663E\u793A\u6240\u6709\u7684API\u63A5\u53E3</li><li>\u5728\u7EC8\u7AEF\u4E0A\u8FDB\u5165\u9879\u76EE\u76EE\u5F55\u4E0B\uFF0C\u6267\u884C\u547D\u4EE4\uFF1A<code>swift run Run routes</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>+--------+----------------+
<span class="token operator">|</span> GET    <span class="token operator">|</span> /              <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> GET    <span class="token operator">|</span> /hello         <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> GET    <span class="token operator">|</span> /todos         <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> GET    <span class="token operator">|</span> /todos/:todoID <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> POST   <span class="token operator">|</span> /todos         <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> DELETE <span class="token operator">|</span> /todos/:todoID <span class="token operator">|</span>
+--------+----------------+
<span class="token operator">|</span> PATCH  <span class="token operator">|</span> /todos/:todoID <span class="token operator">|</span>
+--------+----------------+
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="\u53C2\u8003\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u6863" aria-hidden="true">#</a> \u53C2\u8003\u6587\u6863</h4>`,87),k={href:"https://docs.vapor.codes/4.0/",target:"_blank",rel:"noopener noreferrer"},d=p("Vapor Docs"),b={href:"https://betterprogramming.pub/vapor-4-todo-backend-5035c9d7e295",target:"_blank",rel:"noopener noreferrer"},m=p("How to Build a To-Do List Back End With Vapor 4 and Swift"),f={href:"https://www.raywenderlich.com/16909142-testing-in-vapor-4",target:"_blank",rel:"noopener noreferrer"},g=p("Testing in Vapor 4");function w(y,h){const s=t("ExternalLinkIcon");return e(),o(c,null,[r,n("p",null,[n("a",k,[d,a(s)])]),n("p",null,[n("a",b,[m,a(s)])]),n("p",null,[n("a",f,[g,a(s)])])],64)}var T=u(i,[["render",w]]);export{T as default};
